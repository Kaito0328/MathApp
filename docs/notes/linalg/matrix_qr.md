# QR 分解（Householder/列ピボット/経路）

## 背景知識
QR 分解は A=QR（Q 直交/ユニタリ，R 上三角）により最小二乗や数値安定な解法を提供する。Householder 反射は安定かつ高効率であり，大規模では列ピボットやブロック化が有効である。

## 入力例と出力例
- 入力: A∈R^{m×n}（m≥n を想定，複素は共役転置）。
- 出力: Q（暗黙的に Householder ベクトル v_i と τ_i で格納），R（上三角），必要なら列ピボット P。

## アルゴリズム
- Householder 逐次法（列ごと）
  1) i=1..n で，x=A[i:m,i]。
  2) α=−sign(x_1) ||x||_2，v=x; v_1←v_1−α，v←v/||v||。
  3) A[i:m,i:n] ← A[i:m,i:n] − 2 v (v^T A[i:m,i:n])。
  4) v を格納（下三角に格納し，τ=2 を記録）。
  5) 必要なら Q の適用は遅延し，最後に y←Q^T y として反射を逆順で適用する。
- 列ピボット付き QR（rank 判定に有用）
  - 各列の 2 乗ノルムを追跡し，最大の列を i 列目にスワップ（P を更新）。
  - 残差ノルムが小さくなったところで rank を推定し，R11 を有効部分とする。
- ブロック QR（Level-3 BLAS）
  - パネルで複数反射を蓄積し，コンパクト WY 形式 Q=I−YTY^T で更新。メモリ局所性が良い。

### 境界条件・安定化
- ゼロ列・劣決定では α=0 に注意。列ピボットで病的例を回避。
- 直交性の喪失は再直交化（Gram–Schmidt 修正/二重）で補正するが，基本は Householder を推奨。

### 計算量
- 標準 QR は O(m n^2)。ブロック化で実効性能を向上。
