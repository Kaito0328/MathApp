# 状態空間（連続/離散、ZOH、TF⇄SS）

## 背景知識
状態空間は ẋ=Ax+Bu, y=Cx+Du（連続）および x_{k+1}=Ax_k+Bu_k, y_k=Cx_k+Du_k（離散）で与えられる。SISO の可制御正準形を用いると多項式の係数から直接 A,B,C,D を構成できる。

## 入力例と出力例
- 入力: A,B,C,D と fs。あるいは TF の分子分母多項式。
- 出力: ZOH 離散化（Ad,Bd,C,D）、TF⇄SS の相互変換、応答シミュレーション系列。

## アルゴリズム
- ZOH 離散化: ブロック行列 M=[[A,B],[0,0]]·Ts の行列指数 em=exp(M) を計算し、Ad=em[0:n,0:n], Bd=em[0:n,n:n+m] とする。C,D は保存する。
- TF→SS（SISO）: 連続の分母を monic 化し、可制御正準形の A（伴随行列形）、B=e_n、C は調整済み分子係数（b_tilde）、D は直達項とする。
- SS→TF（SISO 簡易）: 正準形を仮定して係数を復元する（一般の (zI-A)^{-1} の厳密展開は TODO）。
- 離散 SS 応答: x を 0 で初期化し、u=δ[n] または u=1 の入力で y_k と x_{k+1} を逐次更新する。

実装詳細と安定化:
- exp(M) は linalg の expm（パデ近似＋スケーリング/スクエアリング）を利用し、||M|| が大きい場合のオーバーフローを回避する。
- TF→SS の係数調整: 分母を monic 化後、分子から直達項 D を分離し b_tilde = num − D·den を次数 n−1 にゼロ埋めして C に配置する。
- 離散シミュレーションは丸め誤差蓄積に注意し、長系列ではカスケード分解や観測可能正準形を検討する。
