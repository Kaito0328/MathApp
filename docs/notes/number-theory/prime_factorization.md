# 素因数分解

## 背景知識
素因数分解は整数 n を素数の積に分解する操作であり，暗号や数論アルゴリズムの基礎である。

## 入力例と出力例
- 入力: n（u64 / BigInt）。
- 出力: 因数の配列（昇順）。

## アルゴリズム
- u64 版 factor(n):
  - ホイール試し割り: まず 2,3,5 を割り尽くし，残りに対し 30k+r（r∈{±1,±7,±11,±13}）のみを試す。d^2>n で停止する。
  - 末尾が 1 でなければ素数性を確率的に判定（Miller–Rabin）。合成と判定されれば Pollard’s Rho で 2 因子に分割して再帰する。

- BigInt 版 factor_for_big(n):
  - 事前の小さな素数による試し割り（bound 指定）で簡約。
  - 早期分割: Pollard’s Rho を複数回試す（多倍長版）。
  - 残った場合の準・二次篩（Quadratic Sieve ライク）：
    1) 因子基の構築: 素数 p≤B で n が平方剰余になるもののみ採用（Legendre/Jacobi で判定）。
    2) ふるい: x≈⌊√n⌋+z（|z|≤M）に対し y=x^2−n を評価し，因子基の素数 p で割れるたび log p を引く（スコア最小がスムーズ候補）。
    3) スムーズ判定: y を因子基で完全に割り尽くせた点を関係式として収集（指数ベクトル）。
    4) 線形代数 mod 2: 指数ベクトルを GF(2) で RREF にして自由列から平方積の組合せを得る。
    5) 平方合同: 選ばれた集合の x の積を X、因子基の指数半分で構成した積を Y とし、g=gcd(|X−Y|, n) で非自明因子を得る。
  - 不足時は B や M を拡大して再試行する。

### 計算量と制約
- 試し割りは O(√n)。Pollard’s Rho は経験的に高速（多項式時間の期待値）。
- 準QS部は因子基サイズ F と関係数 R に対しふるい O(M·F/間引き)＋線形代数 O(R^3) が支配である。
- Miller–Rabin は確率的（基数選択で 64bit は決定論化可）。
