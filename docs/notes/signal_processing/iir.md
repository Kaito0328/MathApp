# IIR フィルタ

## 背景知識
IIR は帰還を持つ有限次差分方程式で表される。Butterworth/Chebyshev などの古典設計をデジタル化して用いる。

## 入力例と出力例
- 入力: 次数，サンプルレート，通過帯域/阻止帯域仕様。
- 出力: フィルタ係数（b,a）または適用結果 Signal。

## アルゴリズム
- アナログプロトタイプの設計（Butterworth/Chebyshev I–II/Elliptic）
	1) 正規化ローパスの極（必要なら零）を閉右半平面に配置（安定性のため左半平面）。
	2) 仕様（通過帯域端 ω_p, 阻止帯域端 ω_s, 減衰 Ap/As）から次数 N を算出。
	3) バンド変換: s ← s/Ω_c（LP）、s ← Ω_c/s（HP）、s ← (s^2+Ω_1Ω_2)/(s(Ω_2−Ω_1))（BP）などを適用。

- 離散化
	- 双一次（Tustin）: s ← (2/T)(1−z^{-1})/(1+z^{-1})。周波数ワーピングを補正するため，仕様の角周波数を prewarp する。
	- インパルス不変: H_d(z) を連続の極残差分解から得てサンプルし，折返し歪みに注意する（高域では不利）。
	- ZOH: ブロック行列の行列指数で厳密なゼロ次ホールド離散化を行う（lti-systems 参照）。

- 差分方程式による適用
	- 直達形 I/II/Transposed II の選択。数値的には Transposed II が飽和・丸めに強いことが多い。
	- 二次節（biquad）へ分解し，各節で正規化してダイナミックレンジを保つ。

### 境界条件・安定化
- a_0 を 1 に正規化し，スケーリングで内部状態が発散しないようゲインを調整する。
- 固定小数点では係数量子化により極が単位円外へ出ないよう，節ごとに極配置を監視する。
- 初期遷移は x[<0]=0 とするか，定常初期条件を求めてから開始する。

### 計算量
- 設計は閉形式＋根配置で O(N)。適用はサンプルあたり O(p+q)。

### 計算量と制約
- 適用は O(N·(p+q))。極配置と安定性，スケーリングに注意。数値飽和や初期遷移に注意。
