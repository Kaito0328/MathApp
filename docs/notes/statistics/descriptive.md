# 記述統計とユーティリティ

## 背景知識
実データには NaN/Inf が混入することがあり，統計量の計算前に除去する必要がある。分散推定は一回走査で安定に求めるのが望ましい。

## 入力例と出力例
- 入力: 実数列 xs。
- 出力: 平均・分散（母集団/標本），パーセンタイル。

## アルゴリズム
- clean_finite: NaN/Inf を除外し，必要なら欠損補完戦略（中央値/前方埋め）を適用する。

- Welford（一回通過の平均・分散）
	1) m=0, s=0, k=0 で初期化。
	2) 各 x に対し k←k+1, δ=x−m, m←m+δ/k, s←s+δ·(x−m)。
	3) 母分散: s/k，標本分散: s/(k−1)。標準偏差は √ で得る。
	- 並列合成: (m_a,s_a,k_a),(m_b,s_b,k_b) から m, s を Chan 合成式で統合できる。

- 重み付き平均・分散
	- 平均: m=Σ w_i x_i / Σ w_i。
	- 分散: s=Σ w_i (x_i−m)^2 / Σ w_i（不偏なら重みの補正が必要）。

- ロバスト統計
	- 中央値: 選択アルゴリズム O(n) またはソート O(n log n)。
	- MAD: median(|x_i−median(x)|)。正規化係数 1.4826 を掛ける。

- percentile_linear
	- p∈[0,1] に対し h=(n−1)p，i=floor(h)，γ=h−i，戻り値=(1−γ)x_{(i)}+γ x_{(i+1)}。

### 計算量と制約
- Welford/重み付きは O(n)。ソートを伴う分位点は O(n log n)。
- 外れ値が強い場合は平均・分散より中央値・MAD を推奨。自由度や重みの扱いを明示する。
